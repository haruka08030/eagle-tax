## 🚀 次のステップ

### 1. **地図ビジュアライゼーション（US Map）**
    - リストだけでなく、米国地図上で危険な州を赤く塗りつぶすビューを追加
### 2. **ショップ接続フローの実装 (OAuth)**
    - ユーザーが自分のShopifyストアのURLを入力し、アクセストークンを安全に連携・保存する仕組み。
    - Supabaseの `vault` (機密情報管理) などを活用し、トークンをセキュアに管理。
### 3. **データ保存と履歴管理**
    - 毎回APIを叩くのではなく、診断結果をSupabaseのDBに保存。
    - 「先月と比べてどう変化したか？」というトレンド分析が可能になります。
### 4. **バックグラウンド自動監視**
    - ユーザーがアプリを開かなくても、毎日自動でEdge Functionsが走り、最新の注文データを取得・判定。
### 5. **アラート通知機能**
    - 新たにNexus（納税義務）が発生した瞬間に、メールやSlackで通知。
    - 「気づいたら超えていた」というリスクをゼロにします。
### 6. **レポート出力機能 (PDF/CSV)**
    - 税理士に提出するためのレポートをワンクリックで生成。
### 7. **UI改善:** スマホで見ても崩れないようにする。

### 8. **Shopify APIレート制限（429エラー）のハンドリング**

Shopify APIには厳格なレート制限（Leaky Bucketアルゴリズム）があります。現在の `fetch-shopify-orders` はエラーハンドリングが簡易的で、もし注文数が多いショップや連打などで制限に達すると、アプリがクラッシュまたはエラー画面になります。

**修正方針:**`fetch` のレスポンスステータスが `429 Too Many Requests` だった場合、レスポンスヘッダーの `Retry-After` 秒数だけ待機してから再試行するロジック（Exponential Backoffなど）を組み込む必要があります。

### 9. **データの同期・キャッシュ戦略（アーキテクチャ）**

現在の「画面を開くたびにShopify APIを叩く」構成は、ユーザー数が増えるとShopifyのAPI制限にすぐ引っかかり、表示速度も遅くなります。

**修正方針（中・長期的な改善）:**
「取得（Fetch）」と「表示（View）」を分離します。

1. **同期処理:** バックグラウンド（またはボタン押下時）にShopifyからデータを取得し、**Supabaseのデータベース（ordersテーブルなど）に保存/更新**する。
2. **表示処理:** アプリはSupabaseのデータベースからデータを取得して表示する。
    - これなら、API制限を気にせず高速に表示でき、オフラインでも閲覧可能になります。

---

## 📊 パフォーマンス最適化

### 1. ページネーション

- **問題**: 大量の注文データを一度に取得すると遅い
- **解決**: 250件ずつ取得し、順次処理
- **待機時間**: 500ms（API Rate Limit対策）

### 2. 期間フィルタリング

- **問題**: 全期間のデータを処理すると遅い
- **解決**: 直近12ヶ月のみを対象
- **効果**: 処理時間を大幅に短縮

### 3. Edge Functions

- **コールドスタート**: 1-2秒
- **ウォームスタート**: 100-300ms
- **スケーリング**: 自動
